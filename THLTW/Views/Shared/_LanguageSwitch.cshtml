@using Microsoft.AspNetCore.Localization
@using Microsoft.Extensions.Options

@inject IOptions<RequestLocalizationOptions> LocOptions

@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var cultureItems = LocOptions.Value.SupportedUICultures
        ?.Select(c => new SelectListItem { Value = c.Name, Text = c.DisplayName })
        .ToList() ?? new List<SelectListItem>();
    var returnUrl = string.IsNullOrEmpty(Context.Request.Path) ? "~/" : $"~{Context.Request.Path.Value}";
    var currentCulture = requestCulture?.RequestCulture.Culture.Name ?? "vi-VN";
    var vietnameseText = "Tiáº¿ng Viá»‡t";
    var englishText = "English";
}

<div class="dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-globe me-1"></i>
        @if (currentCulture == "vi-VN")
        {
            <span class="flag-emoji">ðŸ‡»ðŸ‡³</span> @vietnameseText
        }
        else
        {
            <span class="flag-emoji">ðŸ‡ºðŸ‡¸</span> @englishText
        }
    </button>
    <ul class="dropdown-menu">
        <li>
            <form asp-controller="Home" asp-action="SetLanguage" asp-route-returnUrl="@returnUrl" method="post" class="dropdown-item-form">
                <button type="submit" name="culture" value="vi-VN" class="dropdown-item @(currentCulture == "vi-VN" ? "active" : "")" title="@vietnameseText">
                    <span class="flag-emoji">ðŸ‡»ðŸ‡³</span> @vietnameseText
                </button>
            </form>
        </li>
        <li>
            <form asp-controller="Home" asp-action="SetLanguage" asp-route-returnUrl="@returnUrl" method="post" class="dropdown-item-form">
                <button type="submit" name="culture" value="en-US" class="dropdown-item @(currentCulture == "en-US" ? "active" : "")" title="@englishText">
                    <span class="flag-emoji">ðŸ‡ºðŸ‡¸</span> @englishText
                </button>
            </form>
        </li>
    </ul>
</div>

<style>
    .dropdown-item-form {
        margin: 0;
        padding: 0;
    }
    
    .dropdown-item-form .dropdown-item {
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
    }
    
    .dropdown-item-form .dropdown-item:hover {
        background-color: var(--bs-dropdown-link-hover-bg);
        color: var(--bs-dropdown-link-hover-color);
    }
    
    .dropdown-item-form .dropdown-item.active {
        background-color: var(--bs-dropdown-link-active-bg);
        color: var(--bs-dropdown-link-active-color);
    }
</style>
